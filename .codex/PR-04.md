---
id: PR-04
track: host
depends_on: [PR-03]
---
# PR-04: Planner skeleton (pure function) + golden tests (Tier D only)

## Goal
Introduce `plan_render()` as a pure deterministic function and prove determinism with golden tests, starting with Tier D only.

## Changes
- Add `plan_render(input_card, caps, policy) -> RenderPlan`
- For now always produce Tier D:
  - `summary_text` derived from card text fields (best-effort)
  - actions flattened into text links if needed
- Add golden tests:
  - fixtures: `tests/fixtures/render_plan/v1/*.json`
  - expected output JSON snapshots

## Suggested modules
- `crates/messaging-render-core/src/planner.rs`
- `crates/messaging-render-core/tests/golden_planner.rs`

## Acceptance criteria
- Golden tests pass and are deterministic across OS
- No runtime wiring yet (planner not used in production code)
- Coverage includes at least:
  - simple card
  - card with buttons
  - card with images (even if ignored in Tier D)

## Notes
- Keep extraction logic conservative; prefer stability over “smartness” initially.
