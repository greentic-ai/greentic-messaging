---
id: PR-06
track: host
depends_on: [PR-05]
---
# PR-06: Centralize truncation + sanitization rules in planner (capability-driven)

## Goal
Move truncation/sanitization into the planner so behavior is consistent for all providers and store-installed plugins.

## Changes
- Add truncation based on:
  - `max_text_len`
  - `max_payload_bytes` (approximation is OK: deterministic)
- Add sanitization based on:
  - `supports_markdown` / `supports_html`
  - allow only a safe subset; strip unsupported formatting deterministically
- Add warnings:
  - `text_truncated`
  - `payload_trimmed`
  - `formatting_stripped`

## Acceptance criteria
- Golden tests for:
  - deterministic truncation
  - deterministic sanitization
- Planner output includes warnings consistently

## Notes
- Keep sanitization minimal and predictable; donâ€™t over-engineer.
